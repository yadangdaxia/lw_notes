(function(){try{var h=this;function k(a,c){var b=ba;return!!a||(b.log(c),!1)}function ca(a){return a}function m(a,c){for(var b=c.split(".");b.length&&a;)a=a[b.shift()];return a}function n(a,c){if(!Array.isArray(a))return!1;c=c||ca;for(var b=0,d=a.length;b<d;b++)if(!0===c(a[b]))return!0;return!1}function p(a,c,b){a=m(a,c);return"string"===typeof a?a:b||""}function q(a,c){var b=m(a,c);return Array.isArray(b)?b:[]}function r(a,c){for(var b=q(a,c),d=[],e=0,f=b.length;e<f;e++)d.push(t(b[e])?b[e]:{});return d}
function da(a,c){if(!Array.isArray(a))return null;for(var b=0;b<a.length;b++){var d=a[b];if(c(d))return d}return null}function t(a){return!(!a||a.constructor!==Object)};function u(a,c){var b=(h.ButtonWebConfig||{})[a];return void 0===b?c:b}function v(a,c){var b=u(a,c);return"string"===typeof b?b:c||""}function w(a,c){var b=u(a,c);return"boolean"===typeof b?b:c||!1}function x(a){a=u(a);if("function"===typeof a)return a};var y=void 0;function z(){return"try{"+v("siteCatalyst","s")+".tl(true,'e','usebutton')}catch(e){}"}function A(){void 0===y&&(y="function"===typeof m(h,v("siteCatalyst","s")+".tl"));return y}function ea(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(function(a){return!!navigator.userAgent.match(a)})}function B(){try{return(new Intl.DateTimeFormat).resolvedOptions().timeZone}catch(a){return null}};function C(a,c){for(var b in c){var d=c[b];"[object Object]"===Object.prototype.toString.call(d)?C(a[b],d):a[b]=d}}function D(a,c){var b=document.createElement(a),d=Array.prototype.splice.call(arguments,1);"a"===a&&(b.rel="noskim",b.setAttribute("data-bttnio-link",1),A()&&b.setAttribute("onclick",z()));for(var e=0,f=d.length;e<f;e++)for(var g in d[e])d[e].hasOwnProperty(g)&&(b.style[g]=d[e][g]);return b}
function E(a,c){var b,d=D(a);C(d,c);b=b||[];for(var e=0,f=b.length;e<f;++e)d.appendChild(b[e]);return d};var fa=/^(?:track\.bttn\.io\/([^\/]+).*|(?!track)([^\.]+)\.bttn\.io(?:\/.*|$))/,F=D("a");function H(a){return a.replace(/^www./,"").toLowerCase()}function ga(){var a={},c=F.search.replace(/^\?/,"").split("&"),b,d,e;b=0;for(d=c.length;b<d;b++)e=c[b].split("="),a[e[0]]=decodeURIComponent(e[1]||"");return a}
function I(a){var c=a.dataset.bttnioTargetHref;if(void 0!==c)return c;var c=u("relativeLinkLocation"),c=t(c)?c:null,b=document.createElement("a");b.href="/";c=null===c||b.hostname!==a.hostname?{hostname:a.hostname,port:a.port}:{hostname:p(c,"hostname",a.hostname),port:p(c,"port",a.port)};F.href=a.href;F.hostname=c.hostname;c.port&&(F.port=c.port);return F.href}
function ha(a,c){var b=c.links_configuration,d=I(a);F.href=d;var e=H(F.hostname),f=F.pathname,g=ga();if(!b||a.getAttribute("data-bttnio-enhanced")||a.getAttribute("data-bttnio-link"))return!1;var l=r(b,"supported_hostnames");if(n(l,function(a){return e===H(p(a,"hostname"))}))return!0;d=r(b,"supported_bttnio_subdomains");if(d.length){var K=(e+f).match(fa);if(K){var L=K[1]||K[2];if(n(d,function(a){return L.toLowerCase()===p(a,"subdomain")}))return!0}}b=r(b,"supported_affiliates");return n(b,function(a){if(e!==
H(p(a,"hostname")))return!1;var b=r(a,"query_url_keys"),b=n(b,function(a){a=p(a,"key");if(g.hasOwnProperty(a)){var b=H(E("a",{href:g[a]}).hostname);return n(l,function(a){return b===H(p(a,"hostname"))})}return!1}),c=r(a,"query_ids"),c=n(c,function(a){var b=p(a,"key");return g.hasOwnProperty(b)?(a=r(a,"values"),n(a,function(a){return p(a,"value")===g[b]})):!1});a=r(a,"pathname_ids");a=n(a,function(a){var b=p(a,"regex"),c;if(!b)return!1;try{c=(new RegExp(b)).exec(f)}catch(d){return!1}if(c){var e=c.slice(1);
a=r(a,"matches");return n(a,function(a){a:if(a=q(a,"values"),Array.isArray(e)&&Array.isArray(a)&&e.length===a.length){var b,c;b=0;for(c=e.length;b<c;b++)if(e[b]!==a[b]){a=!1;break a}a=!0}else a=!1;return a})}return!1});return b||c||a})};function ia(a){try{return h.JSON.stringify(a)}catch(c){return"{}"}};function ja(a){var c=h.XMLHttpRequest,b=J;this.a=a;this.c=c;this.b=b}
function ka(a,c,b,d,e,f){var g=new a.c;g.onreadystatechange=function(){if(4===g.readyState&&"function"===typeof f){var b=g.responseText,c=a.b,d;try{(d=h.JSON.parse(b))&&d.constructor===Object||(d={})}catch(e){c.log("Invalid JSON:"+b),d={}}f(d)}};g.open(c,a.a+b);if(Array.isArray(e))for(c=0;c<e.length;c++)g.setRequestHeader(e[c].w,e[c].value);g.setRequestHeader("X-BTNVersion","2.3.0");d&&g.setRequestHeader("Content-Type","application/json");g.send(d?ia(d):void 0)}
function la(a,c,b){ka(a,"GET",c,null,null,b)}function M(a,c,b,d,e){ka(a,"POST",c,b,d,e)};function N(a){a+="=";var c=document.cookie.split(";"),b,d;for(b=0;b<c.length;b++){for(d=c[b];" "===d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a))return d.substring(a.length,d.length)}}function O(a,c,b,d){a=[a+"="+c,"path=/","max-age="+(void 0===b?31536E3:b)];d&&"string"===typeof d&&0<d.trim().length&&a.push("domain=."+d);document.cookie=a.join(";")};function P(a){a=m(a,"search")||"";return(/^[?]/.test(a)?a.slice(1):a).split("&").reduce(function(a,b){var d=b.split("="),e=h.decodeURIComponent(d[0]||""),d=h.decodeURIComponent(d[1]||"");e&&(a[e]=d);return a},{})};function ma(a){O("bttnreferrertoken",a,void 0,v("referrerCookieDomain"))}function na(a){O("btn_js_widget_enrollment_id",a)}function oa(){var a=h.location,c=P(a).btn_ref;c&&ma(c);(a=P(a).btn_enrollment_id)&&na(a)}function Q(){return N("bttnreferrertoken")};function R(a,c){"function"===typeof a&&a.apply(h,Array.prototype.slice.call(arguments,1))};function pa(a,c,b){var d=[],e=u("userIdentifier"),f,g;f=0;for(g=c.length;f<g;f++)d.push({pub_ref:c[f].dataset.bttnioPubRef,href:I(c[f])});a={application_id:a,links:d};b&&(a.session_id=b);e&&(a.thirdparty_id=e);return a}
function S(a,c,b,d,e){this.c=T();this.l=c;this.o=b;this.f=d;this.a=a;this.g=e;this.i=!!N("bttnlockout");this.h=null;this.b=[];this.j=!1;this.c&&this.a.log("Restored sessionId: "+this.c);oa();if(this.i)this.a.log("bttnlockout cookie found: platform is not supported");else{var f=this;u("enhanceLinks")&&qa(this.f,function(a){f.h=a;f.refresh()});ta(this.g)&&ua(this.f,function(a){f.g.b=a;va(f.g);wa(f.g)&&xa(f.f,a,function(a){a?ya(f.g):f.a.log("Widget could not be displayed. Please check network logs!")})});
u("enableAutomaticActivityReporting")&&za(f.f);(a=u("siteCatalyst"))&&"function"!==typeof h[a].tl&&this.a.log("Invalidate SiteCatalyst detected: "+a+".tl is not a function")}}function Aa(a){if(!a.h)return[];var c=[].slice.call(document.querySelectorAll(v("linkSelector","a"))),b=[],d,e;d=0;for(e=c.length;d<e;d++)ha(c[d],a.h)&&b.push(c[d]);return b.slice(0,50)}
S.prototype.refresh=function(a){var c=this,b=v("applicationId");c.i?c.a.log("Unsupported platform; will not make requests"):b?(c.b=Aa(c),1>c.b.length||(b=pa(b,c.b,c.c),M(c.l,"/v1/web-session/get-buttons",b,null,function(b){if("error"in b)c.a.log("Error enhancing links: "+m(b,"error.message")),R(a,!1,[]);else{var e=m(b,"object.supported_os");c.j||(c.j=!0,R(x("onLoad"),e));if(e){var e=m(b,"object.links")||[],f=e.length,g=p(b,"object.session_id");b=[];c.c&&g===c.c||c.a.log("Initiating new session: "+
g);c.c=g;O("bttnsessionid",g);if(f===c.b.length)for(g=0;g<f;g++)e[g]&&(c.b[g].href=e[g],c.b[g].setAttribute("rel","noskim"),c.b[g].setAttribute("data-bttnio-enhanced",1),A()&&c.b[g].setAttribute("onclick",z()));R(x("onButtonsLoaded"),b);R(a,!0,b)}else c.a.log("Received unsupported platform signal. Will set bttnlockout cookie"),O("bttnlockout","1",14400)}}))):c.a.log("Error: No applicationId present in ButtonWebConfig!")};S.prototype.logout=function(){O("bttnsessionid","",0)};
S.prototype.reportEvent=function(a,c,b){U(this.f,a,c,b)};S.prototype.getReferrerToken=function(){return Q()};S.prototype.reportOrder=function(a,c){if(t(a)){var b=v("applicationId");if(b){var b=h.btoa(b+":"),d=Q(),e=w("reportAllOrders");d||e?(d&&(a.btn_ref=d),M(this.o,"/v1/mobile-order",a,[{w:"Authorization",value:"Basic "+b}],function(a){"function"===typeof c&&c(a)})):this.a.log("Missing btn_ref")}else this.a.log("Missing ButtonWebConfig.application_id")}else this.a.log("Invalid order, cannot post")};function V(a,c){var b=window.sessionStorage;if(b&&a&&"function"===typeof b.setItem)try{var d=h.JSON.stringify(c);"string"===typeof d&&b.setItem(a,d)}catch(e){}}function W(a){var c=window.sessionStorage;if(c&&a&&"function"===typeof c.getItem)try{var b=c.getItem(a);return b?h.JSON.parse(b):void 0}catch(d){return null}};var Ba={position:"fixed",display:"block",height:"0","max-width":"440px","box-shadow":"0px -8px 20px rgba(0, 0, 0, 0.1)",transition:"ease 0.65s","z-index":"9999",border:"0"},Ca={position:"fixed",top:"0",height:"100vh",width:"100vw",background:"#222222",opacity:"0.6","z-index":"9998"},X=Object.freeze({v:"btn_js_widget_display_occurred",u:"btn_js_widget_dismiss_occurred",m:"btn_js_site_page_view_count",s:"btn_js_widget_phone_enrolled"});
function Da(){var a=J,c=Ea;this.a=a;this.c=this.b=null;this.j=function(b){b&&document.body.appendChild(b);O(X.v,"true",1800);a.log("Widget is ready!")};this.h=function(b,c){var e=m(b,"data.arguments.height");c.style.height=e+"px";c.style.width="100%";c.height=e+"px";c.width="100%";a.log("Resetting widget height: "+e)};this.f=function(b){b=m(b,"data.arguments.phoneNumber");Fa(c,b,this.b,function(a){O(X.s,"true");na(a)});a.log("Collecting phone number: "+b)};this.g=function(b){var d=m(b,"data.arguments.eventName");
b=m(b,"data.arguments.eventBody");d?U(c,d,b,function(b){b?a.log("Successfully reported event: "+d):a.log("Could not report event: "+d)}):a.log("No event name provided!")};this.i=function(b,d,e){var f=this;b=m(b,"data.arguments.delay");h.setTimeout(function(){d&&d.parentNode&&d.parentNode.removeChild(d);e&&e.parentNode&&e.parentNode.removeChild(e);if(f.c){window.removeEventListener("message",f.c);f.c=null;O(X.u,"true",2592E3);var a=m(f.b,"smscampaign_id"),b=m(f.b,"onsite_style.template");U(c,"btn:web-widget-dismissed",
{promotion_source_token:Q(),smscampaign_id:a,template_url:b},function(a){a?f.a.log("btn:web-widget-dismissed event was successfully reported!"):f.a.log("Could not report btn:web-widget-dismissed event!")})}},Number(b));a.log("Dismissing widget after "+b+" ms")}}
function ta(a){return u("enableSmsCollection")?N(X.s)?(a.a.log("User phone number already enrolled. Should not be shown!"),!1):N(X.v)?(a.a.log("Widget was displayed in the last 30 mins. Should not be shown!"),!1):N(X.u)?(a.a.log("Widget was dismissed in the last 30 days. Should not be shown!"),!1):!0:(a.a.log("Brand has not enabled SMS Collection. Should not be shown!"),!1)}
function wa(a){if(!a.b)return a.a.log("Currently ineligible due to missing SMS campaign"),!1;var c=m(a.b,"onsite_display_conditions.page_view_count"),b=W(X.m);if(c&&"number"===typeof c&&b<c)return a.a.log("Inhibited display due to insufficient page view count"),!1;var c=window.location.pathname,d=m(a.b,"onsite_display_conditions.page_pattern_denylist");if(d&&Array.isArray(d))for(b=0;b<d.length;b++)if((new RegExp(d[b])).test(c))return a.a.log("Inhibited display due to matching a pathname that matches a denylist entry"),
!1;if((d=m(a.b,"onsite_display_conditions.page_pattern_allowlist"))&&Array.isArray(d)&&d.length){for(b=0;b<d.length;b++)if((new RegExp(d[b])).test(c))return!0;a.a.log("Inhibited display due to not matching any allowlist entries");return!1}return!0}function va(a){var c=W(X.m);"number"!==typeof c||"number"===typeof c&&c!==c?(a.a.log("Reset page view count due to seeing a non-numeric value"),V(X.m,1)):V(X.m,c+1)}
function ya(a){var c=ea(),b=m(a.b,"onsite_style.template")||"https://cdn.usebutton.com/web-widgets/SmsCollectionV1.html",d=E("iframe",{className:"btn___widget",src:b+"?origin="+window.location.protocol+"//"+window.location.host,height:0,style:Object.assign({},Ba,c?{bottom:"0"}:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"})}),e=c?null:E("div",{className:"btn___widget_bg",style:Ca}),f=!1;a.c=function(c){if(c&&b.startsWith(c.origin)){var l=m(c,"data.name");if(l)switch(l){case "Button.web.onReady":f||
(a.j(e),f=!0);break;case "Button.web.resetDimensions":a.h(c,d);break;case "Button.web.collectPhoneNumber":a.f(c);break;case "Button.web.reportEvent":a.g(c);break;case "Button.web.dismissWidget":a.i(c,d,e);break;default:a.a.log("Unsupported message received: "+l)}}};window.addEventListener("message",a.c);d.addEventListener("load",function(){var c=m(a.b,"onsite_style"),e=u("applicationId"),f=Q(),L=B(),ra=window.location.href,G,aa=W("btn_js_sms_campaign");aa&&(G=m(aa,"value"),G=m(G,"smscampaign_id"));
c=Object.assign({},c,{applicationId:e,sourceToken:f,smsCampaignId:G,timezone:L,currentUrl:ra});try{d.contentWindow.postMessage(c,b)}catch(sa){a.a.log("Error injecting data to the widget: "+sa)}});document.body.appendChild(d);a.a.log("Attempting to load widget found at: "+b)};var Ga=/^sess-/;function Ha(){var a=Ia,c=Ja;this.a=J;this.b=a;this.A=c;this.o=!!N("bttnlockout");this.i=this.g=this.j=this.f=this.h=this.c=!1;this.l=function(a){var c=T();(a=m(a,"object.session_id"))&&"string"===typeof a&&a!==c&&(this.a.log("Refreshing session ID: "+a),O("bttnsessionid",a))};this.B=function(a){(a=m(a,"object.source_token"))&&ma(a)}}function T(){var a=N("bttnsessionid");return Ga.test(a)?a:void 0}
function qa(a,c){var b=u("applicationId");b?a.c||(a.c=!0,la(a.b,"/v1/web-session/config?application_id="+b,function(b){a.c=!1;R(c,m(b,"object")||null)})):a.a.log("Missing ButtonWebConfig.application_id")}
function U(a,c,b,d){var e=T();e?a.o?a.a.log("Platform not supported, will not report events"):a.h||(a.h=!0,M(a.b,"/v1/web-session/events",{session_id:e,events:[{name:c,value:t(b)?b:void 0}]},null,function(b){a.h=!1;b="ok"===m(b,"meta.status");R(d,b)})):a.a.log("Cannot report event. Missing session ID!")}
function ua(a,c){var b=u("applicationId"),d=Q(),e=T();if(b){var f=W("btn_js_sms_campaign");if(f)b=m(f,"value"),R(c,b);else if(!a.f){a.f=!0;var f=P(h.location),g={},l;for(l in f)f.hasOwnProperty(l)&&(g[l]=l.startsWith("utm_")?f[l]:null);M(a.b,"/v1/web-session/collection-campaign/eligibility",{application_id:b,session_id:e,source_token:d,page_query:g},null,function(b){a.f=!1;a.l(b);b=m(b,"object.smscampaign");V("btn_js_sms_campaign",{fetched_at:h.Date.now(),value:b});R(c,b)})}}else a.a.log("Missing ButtonWebConfig.application_id")}
function xa(a,c,b){var d=T(),e=Q();c=m(c,"smscampaign_id");var f=window.location.href;d?a.j||(a.j=!0,M(a.b,"/v1/web-session/collection-campaign/display",{session_id:d,source_token:e,smscampaign_id:c,current_url:f},null,function(c){a.j=!1;a.l(c);a.B(c);c=m(c,"object.source_token");R(b,!!c)})):a.a.log("Missing session ID!")}
function Fa(a,c,b,d){var e=T(),f=Q(),g=m(b,"smscampaign_id");b=m(b,"onsite_style.template");var l=B();e?a.g||(a.g=!0,M(a.b,"/v1/web-session/collection-campaign/enrollment",{session_id:e,source_token:f,phone_number:c,smscampaign_id:g,timezone:l,template:b},null,function(b){a.g=!1;a.l(b);var c=null;try{var e=m(b,"object.enrollments")||[],c=da(e,function(a){return a&&!!a.collection}).collection}catch(f){a.a.log("Failed to extract enrollment ID from response! "+f)}R(d,c)})):a.a.log("Missing session ID!")}
function za(a){var c=window.location.href,b=T(),d=N("btn_js_widget_enrollment_id"),e=Q();b?e?d?a.i||(a.i=!0,M(a.A,"/v1/activity/web/pageview",{url:c,session_id:b,enrollment_id:d,btn_ref:e},null,function(){a.i=!1;R(void 0)})):a.a.log("Skipping page view report because the user is not enrolled"):a.a.log("Missing source token!"):a.a.log("Missing session ID!")};function Ka(a){this.a=a}Ka.prototype.log=function(a){this.a&&h.console&&h.console.log("[Button]",a)};var Y=h.__bttnio||"bttnio",J=new Ka(w("enableLogging",!1));
if(m(h,Y+".ok"))J.log("The ButtonJS snippet was loaded multiple times");else{var La=m(h,Y+".q")||[],Ia=new ja("https://web.usebutton.com"),Ja=new ja("https://api.usebutton.com"),Ea=new Ha,Ma=new Da,ba=J,Z=k(h.XMLHttpRequest,"No XMLHttpRequest")&&k(h.JSON,"No native JSON support")?new S(J,Ia,Ja,Ea,Ma):{};h[Y]=function(){var a=[].slice.call(arguments),c=a.shift();if(c&&"function"===typeof Z[c])return J.log(c+"("+a.join(",")+")"),Z[c].apply(Z,a)};for(h[Y].ok=!0;La.length;)h[Y].apply(this,La.shift())};}catch(e){}})();
